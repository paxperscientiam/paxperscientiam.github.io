<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Chronology of United Nations members' flags.</title>


        <link rel="stylesheet" type="text/css" href="app.css">
        <link rel="stylesheet" href="dist/css/foundation.css">
    </head>
    <body class="grid-x">
        <!-- <select id="toc"></select> -->
        <div class="cell">
            <div id="title" class="">Chronology of United Nations members' flags.</div>
        </div>
        <div id="viewer" class="spreads paper">
        </div>
        <a id="prev" href="#prev" class="arrow">‹</a>
        <a id="next" href="#next" class="arrow">›</a>


        <!-- <script src="dist/vendor/jquery.js"></script>
             <script src="dist/vendor/what-input.js"></script> -->
        <!-- <script src="dist/vendor/foundation.js"></script>
             <script src="dist/js/app.js"></script> -->
        <script src="dist/js/jszip.min.js"></script>
        <script src="dist/js/epub.min.js"></script>
        <script defer>
          var params = URLSearchParams && new URLSearchParams(document.location.search.substring(1));
          var url = params && params.get("url") && decodeURIComponent(params.get("url"));
          var currentSectionIndex = (params && params.get("loc")) ? params.get("loc") : undefined;

          var book = ePub(url || "UN-Flags-Single-Page-1.epub", {});
          var rendition = book.renderTo("viewer", {
              width: "100%",
              height: "100%",
              spread: "always"
          });
          rendition.display(currentSectionIndex);


          book.ready.then(() => {
              var viewer = document.getElementById("viewer");
              var frames = document.body.getElementsByTagName("iframe");
              var next = document.getElementById("next");

              next.addEventListener("click", function(e){
                  book.package.metadata.direction === "rtl" ? rendition.prev() : rendition.next();
                  //                  viewer.style.background = "white url('ajax-loader.gif') center center no-repeat";
                  e.preventDefault();
              }, false);

              var prev = document.getElementById("prev");

              prev.addEventListener("click", function(e){
                  console.log("previous page");
                  frames[0].style.visibility = "hidden";
                  book.package.metadata.direction === "rtl" ? rendition.next() : rendition.prev();
                  e.preventDefault();
              }, false);

              var keyListener = function(e){
                  // Left Key
                  if ((e.keyCode || e.which) == 37) {
                      //                      frames[0].style.visibility = "hidden";
                      book.package.metadata.direction === "rtl" ? rendition.next() : rendition.prev();
                  }

                  // Right Key
                  if ((e.keyCode || e.which) == 39) {
                      book.package.metadata.direction === "rtl" ?
                      rendition.prev() : rendition.next();
                  }

              };

              rendition.on("keyup", keyListener);
              document.addEventListener("keyup", keyListener, false);

              rendition.on("displayed", function () {
                  console.log("displayed");

              });

              rendition.on("next", function () {
                  console.log("FUCKIN NEX");
              })

              rendition.on("started", function () {
                  console.log("started");
              });

              rendition.on("removed", function () {
                  console.log("removed");
              });

              rendition.on("rendered", function () {
                  frames[0].classList.add("page-turning");
                  console.log("rendered");
              });

          })

          rendition.on("layout", function(layout) {
              let viewer = document.getElementById("viewer");

              if (layout.spread) {
                  viewer.classList.remove('single');
              } else {
                  viewer.classList.add('single');
              }
          });

          window.addEventListener("load", function () {
              console.log("loading");
              viewer.classList.add("paper");
          });

          window.addEventListener("unload", function () {
              console.log("unloading");
              this.book.destroy();
          });

          // window.addEventListener("swipeleft", function( event ) {
          //     console.log("SHIT!");
          // });

          // $(window).on( "swipeleft", function( event ) {
          //     rendition.next();
          // });
          //
          // $(window).on( "swiperight", function( event ) {
          //     rendition.prev();
          // });

          // book.loaded.navigation.then(function(toc){
          // 			        var $select = document.getElementById("toc"),
          // 					        docfrag = document.createDocumentFragment();
          //
          // 			        toc.forEach(function(chapter) {
          // 				          var option = document.createElement("option");
          // 				          option.textContent = chapter.label;
          // 				          option.setAttribute("ref", chapter.href);
          //
          // 				          docfrag.appendChild(option);
          // 			        });
          //
          // 			        $select.appendChild(docfrag);
          //
          // 			        $select.onchange = function(){
          // 					        var index = $select.selectedIndex,
          // 							        url = $select.options[index].getAttribute("ref");
          // 					        rendition.display(url);
          // 					        return false;
          // 			        };
          //
          // 		      });
        </script>


    </body>
</html>
