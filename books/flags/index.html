<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Chronology of United Nations members' flags.</title>


        <link rel="stylesheet" type="text/css" href="examples.css">
        <link rel="stylesheet" href="dist/css/foundation.css">
    </head>
    <body class="grid-container">

        <!-- <select id="toc"></select> -->
        <div class="grid-x" >
            <div id="title" class="cell">Chronology of United Nations members' flags.</div>
        </div>
        <div class="grid-x aspect-ratio-box">
            <div id="viewer" class="spreads cell small-8 medium-10 large-12"></div>
        </div>
        <a id="prev" href="#prev" class="arrow">‹</a>
        <a id="next" href="#next" class="arrow">›</a>

        <script src="dist/vendor/jquery.js"></script>
        <script src="dist/vendor/what-input.js"></script>
        <!-- <script src="dist/vendor/foundation.js"></script>
             <script src="dist/js/app.js"></script> -->
        <script src="dist/js/jszip.min.js"></script>
        <script src="dist/js/epub.js"></script>
        <script defer>
          var params = URLSearchParams && new URLSearchParams(document.location.search.substring(1));
          var url = params && params.get("url") && decodeURIComponent(params.get("url"));
          var currentSectionIndex = (params && params.get("loc")) ? params.get("loc") : undefined;

          var book = ePub(url || "UN-Flags-Single-Page-1.epub", {});
          var rendition = book.renderTo("viewer", {
              width: "100%",
              height: "100%",
              spread: "always"
          });
          rendition.display(currentSectionIndex);


          book.ready.then(() => {

              var next = document.getElementById("next");

              next.addEventListener("click", function(e){
                  book.package.metadata.direction === "rtl" ? rendition.prev() : rendition.next();
                  e.preventDefault();
              }, false);

              var prev = document.getElementById("prev");
              prev.addEventListener("click", function(e){
                  book.package.metadata.direction === "rtl" ? rendition.next() : rendition.prev();
                  e.preventDefault();
              }, false);

              var keyListener = function(e){

                  // Left Key
                  if ((e.keyCode || e.which) == 37) {
                      book.package.metadata.direction === "rtl" ? rendition.next() : rendition.prev();
                  }

                  // Right Key
                  if ((e.keyCode || e.which) == 39) {
                      book.package.metadata.direction === "rtl" ? rendition.prev() : rendition.next();
                  }

              };

              rendition.on("keyup", keyListener);
              document.addEventListener("keyup", keyListener, false);
          })

          // rendition.on("relocated", function(location){
          //
          //     var next = book.package.metadata.direction === "rtl" ?  document.getElementById("prev") : document.getElementById("next");
          //     var prev = book.package.metadata.direction === "rtl" ?  document.getElementById("next") : document.getElementById("prev");
          //
          //     if (location.atEnd) {
          //         next.style.visibility = "hidden";
          //     } else {
          //         next.style.visibility = "visible";
          //     }
          //
          //     if (location.atStart) {
          //         prev.style.visibility = "hidden";
          //     } else {
          //         prev.style.visibility = "visible";
          //     }
          //
          // });

          rendition.on("layout", function(layout) {
              let viewer = document.getElementById("viewer");

              if (layout.spread) {
                  viewer.classList.remove('single');
              } else {
                  viewer.classList.add('single');
              }
          });

          window.addEventListener("unload", function () {
              console.log("unloading");
              this.book.destroy();
          });

          window.addEventListener("swipeleft", function( event ) {
              console.log("SHIT!");
          });

          // $(window).on( "swipeleft", function( event ) {
          //     rendition.next();
          // });
          //
          // $(window).on( "swiperight", function( event ) {
          //     rendition.prev();
          // });

          // book.loaded.navigation.then(function(toc){
          // 			        var $select = document.getElementById("toc"),
          // 					        docfrag = document.createDocumentFragment();
          //
          // 			        toc.forEach(function(chapter) {
          // 				          var option = document.createElement("option");
          // 				          option.textContent = chapter.label;
          // 				          option.setAttribute("ref", chapter.href);
          //
          // 				          docfrag.appendChild(option);
          // 			        });
          //
          // 			        $select.appendChild(docfrag);
          //
          // 			        $select.onchange = function(){
          // 					        var index = $select.selectedIndex,
          // 							        url = $select.options[index].getAttribute("ref");
          // 					        rendition.display(url);
          // 					        return false;
          // 			        };
          //
          // 		      });
        </script>


    </body>
</html>
